181a182
> 	var $charSet; // Added 2004-06-20 by Kevin Jamieson (http://www.pkp.ubc.ca/)
393a395,396
> 		} else {
> 			$column_def = '';
731a735,736
> 		$tableflds = $flds;
> 		
742c747
< 					$mt = &$this->MetaType($c->type,$ml);
---
> 					$mt = $this->MetaType($c->type,$ml);
755d759
< 
758d761
< 		$alter = 'ALTER TABLE ' . $this->TableName($tablename);
759a763,764
> 		$addSql = array();
> 		$recreate = false;
760a766
> 		// FIXME 2005-08-01 KJ - Warning, horrible kludge ahead for DBMSs that can't alter column types
769c775,780
< 				$sql[] = $alter . $this->alterCol . ' ' . $v;
---
> 	 			$alter = $this->AlterColumnSQL($tablename, array($id => $tableflds[$id]));
> 	 			if (empty($alter)) {
> 	 				$recreate = true;
> 	 			} else {
> 	 				$sql[] = $alter;
> 	 			}
771c782,785
< 				$sql[] = $alter . $this->addCol . ' ' . $v;
---
> 				$add = $this->AddColumnSQL($tablename, array($id => $tableflds[$id]));;
> 				unset($tableflds[$id]);
> 				$sql[] = $add;
> 				$addSql[] = $add;
774a789,793
> 		if ($recreate) {
> 			$sql = $this->AlterColumnSQL($tablename, false, $tableflds, $tableoptions);
> 			$sql[] = $addSql;
> 		}
> 		
776a796,814
> 	
> 	// Functions for managing the database character encoding
> 	// (for CREATE DATABASE, CREATE TABLE, etc.)
> 	// Added 2004-06-20 by Kevin Jamieson (http://www.pkp.ubc.ca/)
> 	function GetCharSet()
> 	{
> 		if (!$this->charSet) {
> 			return false;
> 		} else {
> 			return $this->charSet;
> 		}
> 	}
> 	
> 	// SetCharSet - switch the client encoding
> 	function SetCharSet($charset_name)
> 	{
> 		$this->charSet = $charset_name;
> 	}
> 
